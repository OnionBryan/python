<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>V24 Complete PESTLE-Maxwell AI Framework - Fixed</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0/dist/tf.min.js"></script>
<script>
(async()=>{await tf.setBackend("webgl");await tf.ready();console.log("TensorFlow.js backend:",tf.getBackend());})();
</script>
<script src="https://cdn.jsdelivr.net/npm/ml@6.1.0/dist/ml.min.js"></script>
<script src="https://unpkg.com/brain.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.4.2/math.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
<style>
/* minimal styles for brevity */
body{margin:0;background:#0a0a0a;color:#e2e8f0;font-family:sans-serif;}
.panel{background:rgba(15,23,42,0.9);border:1px solid rgba(148,163,184,0.2);border-radius:16px;padding:20px;}
</style>
</head>
<body>
<div id="ui-overlay" class="panel">
<button onclick="trainXORNetwork()">Train XOR</button>
<button onclick="runRegression()">Regression</button>
<button onclick="runBayesian()">Bayesian</button>
<button onclick="runDecisionTree()">Decision Tree</button>
<div id="ml-results"></div>
<div id="xor-status">Accuracy: <span id="xor-accuracy">0%</span>, Epoch: <span id="xor-epoch">0</span>, Loss: <span id="xor-loss">0.000</span></div>
</div>
<script>
// Ensure TensorFlow is ready and configured
const tfReady = (async () => {
  if (typeof tf !== 'undefined') {
    await tf.setBackend('webgl');
    await tf.ready();
    console.log('TensorFlow.js backend:', tf.getBackend());
  }
})();

function addDataFeedEntry(msg, level = 'info') {
  const feed = document.getElementById('ml-results');
  const div = document.createElement('div');
  div.textContent = msg;
  div.className = `feed-${level}`;
  feed.appendChild(div);
}

let xorModel;
function trainXORNetwork() {
  addDataFeedEntry('Training XOR Neural Network (brain.js)...', 'info');
  const xorData = [
    { input: [0, 0], output: [0] },
    { input: [0, 1], output: [1] },
    { input: [1, 0], output: [1] },
    { input: [1, 1], output: [0] }
  ];

  xorModel = new brain.NeuralNetwork({
    hiddenLayers: [3],
    activation: 'sigmoid'
  });

  let currentEpoch = 0;
  const totalEpochs = 2000;
  const step = 200;

  const trainStep = () => {
    xorModel.train(xorData, { iterations: step, learningRate: 0.5, momentum: 0.9 });
    currentEpoch += step;
    let correct = 0, loss = 0;
    xorData.forEach(d => {
      const pred = xorModel.run(d.input)[0];
      loss += Math.pow(pred - d.output[0], 2);
      if (Math.round(pred) === d.output[0]) correct++;
    });
    loss /= xorData.length;
    const accuracy = correct / xorData.length;

    document.getElementById('xor-accuracy').textContent = (accuracy * 100).toFixed(0) + '%';
    document.getElementById('xor-epoch').textContent = currentEpoch;
    document.getElementById('xor-loss').textContent = loss.toFixed(3);

    if (currentEpoch < totalEpochs) {
      requestAnimationFrame(trainStep);
    } else {
      addDataFeedEntry(`XOR training complete. Accuracy: ${(accuracy * 100).toFixed(0)}%`, 'success');
    }
  };
  trainStep();
}
function runRegression(){
  tfReady.then(async () => {
    const xs=tf.tensor2d([[0,1],[1,2],[2,3]]);
    const ys=tf.tensor2d([[0],[1],[2]]);
    const model=tf.sequential();
    model.add(tf.layers.dense({units:1,inputShape:[2]}));
    model.compile({optimizer:tf.train.sgd(0.1),loss:'meanSquaredError'});
    await model.fit(xs,ys,{epochs:50});
    const preds=Array.from((await model.predict(xs).data()));
    document.getElementById('ml-results').textContent='Regression: '+preds.map(v=>v.toFixed(2)).join(', ');
  });
}
function runBayesian(){
  const nb=new ML.NaiveBayes({modelType:'Gaussian'});
  nb.train([[0],[1],[2]],[0,1,1]);
  document.getElementById('ml-results').textContent='Bayesian trained';
}
function runDecisionTree(){
  const clf=new ML.DecisionTreeClassifier({gainFunction:'gini',maxDepth:3});
  clf.train([[0],[1],[2]],[0,1,1]);
  document.getElementById('ml-results').textContent='Tree trained';
}
</script>
</body>
</html>
